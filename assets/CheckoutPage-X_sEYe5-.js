import{u as _,q as ee,m as se,h as n,j as e,v as a}from"./index-C4Bhj8Yd.js";import{u as re}from"./index.esm-1IjQ9TB6.js";import{N as E,L as te}from"./Navbar-BOC0zFRs.js";import{B as y}from"./Button-Ba6Qo_8s.js";import{S as ae}from"./shopping-bag-8vcxqj9-.js";import{A as le}from"./arrow-left-DrMZxSIm.js";import{M as ie}from"./minus-DhoM-DRX.js";import{P as ne}from"./plus-mHEB3IxS.js";import{T as oe}from"./trash-2-BgLld3yM.js";import{B as de}from"./bike-BMjQcjh8.js";import{S as ce}from"./store-BVePMQtn.js";import{M as xe}from"./map-pin-HN--pi6j.js";import{a as me,C as pe,B as q}from"./crosshair-D6j1ITQM.js";import{W as ue}from"./wallet-Cz_gNZB9.js";import{C as ge}from"./credit-card-BS4bgOGQ.js";import{S as R}from"./shield-check-DAqxfovH.js";import{S as he}from"./sparkles-DyvculNV.js";import{T as be}from"./tag-DcT4wblf.js";import"./search-BdgAM8L-.js";import"./createLucideIcon-DzImHIgp.js";import"./x-BKaP5agP.js";import"./chevron-right-CAW2906d.js";import"./utensils-CiJvdMyj.js";import"./user-BxgYsqv1.js";import"./bell-B68-w34E.js";import"./message-square-Dci10IDA.js";const Ge=()=>{var D;const p=_(),{cart:u,removeFromCart:k,updateQuantity:S,getCartTotal:V,clearCart:W,user:r,deductWallet:G,accruePoints:Y}=ee(),H=se(s=>s.addOrder),[l,P]=n.useState("cart"),[$,f]=n.useState(!1),[z,g]=n.useState(!1),[t,F]=n.useState("delivery"),[o,T]=n.useState("cash"),[i,j]=n.useState(0),[v,I]=n.useState(""),[d,x]=n.useState(null),{register:h,handleSubmit:U,setValue:A,formState:{errors:Q}}=re(),b=V(),M=t==="delivery"?25:0,N=d?b*d.discount:0,B=(b-N)*.14,c=b-N+M+B+i,w=Math.floor(c*10),J=()=>{if(!v.trim())return;const s=v.toUpperCase();if(s==="WELCOME50")x({code:s,discount:.5}),a.success("Promo applied: 50% OFF");else if(s==="LUNCH20")x({code:s,discount:.2}),a.success("Promo applied: 20% OFF");else if(s==="FREESHIP"){if(t!=="delivery"){a.error("FREESHIP only applies to delivery");return}x({code:s,discount:0}),a.info("Free Shipping applied (Simulated)")}else a.error("Invalid promo code"),x(null)},K=()=>{g(!0),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(s=>{setTimeout(()=>{A("address","90 Road, Maadi"),A("city","Cairo"),g(!1),a.success("Location found!")},1e3)},s=>{g(!1),a.error("Could not access location. Please enter manually.")}):(g(!1),a.error("Geolocation not supported by your browser."))},X=async s=>{var O;if(!r){a.error("Please login to place an order"),p("/login");return}if(o==="wallet"&&r.walletBalance<c){a.error("Insufficient wallet balance. Please top up or select another method.");return}f(!0),await new Promise(L=>setTimeout(L,1500));const m=`ord-${Date.now().toString().slice(-6)}`,Z={id:m,userId:r.id,customerName:r.name,restaurantId:(O=u[0])==null?void 0:O.restaurantId,date:new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),status:"Placed",total:c,items:[...u],deliveryMethod:t,paymentMethod:o,tip:i,deliveryAddress:t==="delivery"?`${s.address}, ${s.city}`:void 0};if(o==="wallet"&&!G(c,`Order #${m.split("-")[1]}`)){f(!1);return}H(Z),Y(w),f(!1),W(),a.success(`Order placed! You earned ${w} points.`),p(`/tracking/${m}`)};if(u.length===0)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(E,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-24 flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mb-6 text-gray-400",children:e.jsx(ae,{size:40})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"Looks like you haven't added anything yet."}),e.jsx(y,{onClick:()=>p("/feed"),children:"Start Exploring"})]})]});const C=s=>{const m=i===s;return e.jsxs("button",{type:"button",onClick:()=>j(s),className:`flex-1 py-2 rounded-lg text-sm font-medium border transition-colors ${m?"bg-brand-500 text-white border-brand-500":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50"}`,children:[s," EGP"]})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(E,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>l==="details"?P("cart"):p("/feed"),className:"flex items-center text-sm text-gray-500 hover:text-brand-500 transition-colors",children:[e.jsx(le,{size:16,className:"mr-1"}),l==="details"?"Back to Cart":"Continue Shopping"]}),e.jsx("h1",{className:"font-serif text-3xl font-bold text-gray-900 mt-4",children:l==="cart"?"Your Cart":"Checkout"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-6",children:[l==="cart"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsx("div",{className:"p-6 space-y-6",children:u.map(s=>e.jsxs("div",{className:"flex gap-4 py-4 border-b border-gray-100 last:border-0 last:pb-0 first:pt-0",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-24 h-24 rounded-lg object-cover bg-gray-100"}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:s.title}),e.jsxs("span",{className:"font-bold text-gray-900",children:["$",(s.price*s.quantity).toFixed(2)]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.restaurantName}),s.selectedOptions&&s.selectedOptions.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+ ",s.selectedOptions.join(", ")]}),s.instructions&&e.jsxs("p",{className:"text-xs text-brand-600 italic mt-1 bg-brand-50 inline-block px-1 rounded",children:['"',s.instructions,'"']})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>s.quantity>1?S(s.cartId,-1):k(s.cartId),className:"p-1 hover:bg-white rounded-md transition-colors text-gray-600",children:e.jsx(ie,{size:14})}),e.jsx("span",{className:"text-sm font-medium w-4 text-center",children:s.quantity}),e.jsx("button",{onClick:()=>S(s.cartId,1),className:"p-1 hover:bg-white rounded-md transition-colors text-gray-600",children:e.jsx(ne,{size:14})})]}),e.jsx("button",{onClick:()=>k(s.cartId),className:"text-gray-400 hover:text-red-500 transition-colors p-2",children:e.jsx(oe,{size:16})})]})]})]},s.cartId))})}),l==="details"&&e.jsxs("form",{id:"checkout-form",onSubmit:U(X),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>F("delivery"),className:`cursor-pointer p-4 rounded-xl border-2 transition-all flex items-center gap-3 ${t==="delivery"?"border-brand-500 bg-brand-50":"border-gray-200 bg-white hover:border-brand-200"}`,children:[e.jsx("div",{className:`p-2 rounded-full ${t==="delivery"?"bg-brand-500 text-white":"bg-gray-100 text-gray-500"}`,children:e.jsx(de,{size:20})}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-gray-900",children:"Delivery"}),e.jsx("span",{className:"text-xs text-gray-500",children:"To your door"})]})]}),e.jsxs("div",{onClick:()=>F("pickup"),className:`cursor-pointer p-4 rounded-xl border-2 transition-all flex items-center gap-3 ${t==="pickup"?"border-brand-500 bg-brand-50":"border-gray-200 bg-white hover:border-brand-200"}`,children:[e.jsx("div",{className:`p-2 rounded-full ${t==="pickup"?"bg-brand-500 text-white":"bg-gray-100 text-gray-500"}`,children:e.jsx(ce,{size:20})}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-gray-900",children:"Pickup"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Skip the fee"})]})]})]}),t==="delivery"&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-brand-100 p-2 rounded-lg text-brand-600",children:e.jsx(xe,{size:20})}),e.jsx("h2",{className:"font-bold text-lg text-gray-900",children:"Delivery Address"})]}),e.jsxs("button",{type:"button",onClick:K,className:"text-brand-600 text-sm font-medium flex items-center gap-1 hover:text-brand-700 disabled:opacity-50",disabled:z,children:[z?e.jsx(te,{size:14,className:"animate-spin"}):e.jsx(me,{size:14}),"Locate Me"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Street Address"}),e.jsx("input",{...h("address",{required:t==="delivery"}),type:"text",placeholder:"e.g. 15 Tahrir Square",defaultValue:(D=r==null?void 0:r.addresses[0])==null?void 0:D.fullAddress,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all"}),Q.address&&e.jsx("span",{className:"text-red-500 text-xs mt-1",children:"Address is required"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City / District"}),e.jsx("input",{...h("city",{required:t==="delivery"}),type:"text",placeholder:"Cairo",defaultValue:"Cairo",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{...h("phone",{required:!0}),type:"tel",placeholder:"+20 1xx xxx xxxx",defaultValue:r==null?void 0:r.phone,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Instructions"}),e.jsx("textarea",{...h("instructions"),placeholder:"Gate code, leave at door, etc.",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all",rows:2})]})]})]}),t==="delivery"&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-yellow-100 p-2 rounded-lg text-yellow-600",children:e.jsx(pe,{size:20})}),e.jsx("h2",{className:"font-bold text-lg text-gray-900",children:"Tip your Rider"})]}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"100% of the tip goes to your rider."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>j(0),className:`px-4 py-2 rounded-lg text-sm font-medium border transition-colors ${i===0?"bg-gray-800 text-white":"bg-white text-gray-600 border-gray-200"}`,children:"Not now"}),C(10),C(20),C(50)]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-gray-500",children:"EGP"}),e.jsx("input",{type:"number",value:i>0?i:"",onChange:s=>j(parseFloat(s.target.value)||0),placeholder:"Custom amount",className:"w-full pl-12 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-500 outline-none text-sm"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"bg-brand-100 p-2 rounded-lg text-brand-600",children:e.jsx(q,{size:20})}),e.jsx("h2",{className:"font-bold text-lg text-gray-900",children:"Payment Method"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{onClick:()=>T("wallet"),className:`cursor-pointer p-4 rounded-xl border-2 transition-all flex flex-col items-center justify-center gap-2 text-center h-28 ${o==="wallet"?"border-brand-500 bg-brand-50 text-brand-700":"border-gray-200 bg-white hover:border-brand-200"}`,children:[e.jsx(ue,{size:24}),e.jsx("span",{className:"font-bold text-sm",children:"Wallet Balance"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["$",r==null?void 0:r.walletBalance.toFixed(2)]})]}),e.jsxs("div",{onClick:()=>T("cash"),className:`cursor-pointer p-4 rounded-xl border-2 transition-all flex flex-col items-center justify-center gap-2 text-center h-28 ${o==="cash"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 bg-white hover:border-green-200"}`,children:[e.jsx(q,{size:24}),e.jsx("span",{className:"font-bold text-sm",children:"Cash on Delivery"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Pay when arrived"})]}),e.jsxs("div",{className:"cursor-not-allowed opacity-60 p-4 rounded-xl border-2 transition-all flex flex-col items-center justify-center gap-2 text-center h-28 border-gray-100 bg-gray-50 text-gray-400",children:[e.jsx(ge,{size:24}),e.jsx("span",{className:"font-bold text-sm",children:"Card (Disabled)"})]})]}),o==="cash"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-4 bg-gray-50 p-3 rounded-lg",children:[e.jsx(R,{size:14,className:"text-green-600"}),"Cash payments are verified upon delivery/pickup."]}),o==="wallet"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-4 bg-gray-50 p-3 rounded-lg",children:[e.jsx(R,{size:14,className:"text-brand-600"}),"Payment will be deducted immediately from your wallet."]})]})]})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 sticky top-24",children:[e.jsx("h2",{className:"font-bold text-lg text-gray-900 mb-6",children:"Order Summary"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",b.toFixed(2)]})]}),t==="delivery"&&e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsxs("span",{children:["$",M.toFixed(2)]})]}),d&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 font-medium bg-green-50 p-2 rounded",children:[e.jsxs("span",{children:["Discount (",d.code,")"]}),e.jsxs("span",{children:["-$",N.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"VAT (14%)"}),e.jsxs("span",{children:["$",B.toFixed(2)]})]}),i>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 font-medium",children:[e.jsx("span",{children:"Rider Tip"}),e.jsxs("span",{children:["$",i.toFixed(2)]})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-3 flex justify-between font-bold text-gray-900 text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",c.toFixed(2)]})]}),l==="details"&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-orange-600 bg-orange-50 px-3 py-2 rounded-lg mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{size:12})," You will earn"]}),e.jsxs("span",{className:"font-bold",children:[w," Points"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:v,onChange:s=>I(s.target.value),placeholder:"Promo Code",className:"w-full pl-8 pr-4 py-2 rounded-lg border border-gray-200 text-sm focus:border-brand-500 outline-none uppercase"}),e.jsx(be,{size:14,className:"absolute left-2.5 top-3 text-gray-400"})]}),e.jsx(y,{size:"sm",variant:"secondary",onClick:J,disabled:!!d,children:"Apply"})]}),d&&e.jsx("button",{onClick:()=>{x(null),I("")},className:"text-xs text-red-500 mt-1 hover:underline ml-1",children:"Remove code"})]}),l==="cart"?e.jsx(y,{className:"w-full py-3",size:"lg",onClick:()=>P("details"),children:"Proceed to Checkout"}):e.jsx(y,{className:"w-full py-3 flex items-center justify-center gap-2",size:"lg",form:"checkout-form",disabled:$,children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/50 border-t-white rounded-full animate-spin"}),"Processing..."]}):`Place Order â€¢ $${c.toFixed(2)}`}),l==="details"&&e.jsx("p",{className:"text-xs text-center text-gray-400 mt-4",children:"By placing your order, you agree to our Terms of Service and Privacy Policy."})]})})]})]})]})};export{Ge as default};
